<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>√öltimos Movimientos</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }
  </style>
</head>

<body>

<div class="container">
  <h2>√öltimos Movimientos</h2>
  <hr>

  <div class="mb-3">
    <label for="filtroTipo" class="form-label">
      Filtrar por tipo de movimiento
    </label>
    <select id="filtroTipo" class="form-select">
      <option value="todos">Todos</option>
      <option value="deposito">Dep√≥sito</option>
      <option value="retiro">Retiro</option>
      <option value="transferencia">Transferencia</option>
    </select>
  </div>

  <table class="table table-bordered table-striped">
    <thead class="table-primary">
      <tr>
        <th>Fecha</th>
        <th>Movimiento</th>
        <th>Monto</th>
      </tr>
    </thead>
    <tbody id="tablaMovimientos">
      <!-- Se completa con JS -->
    </tbody>
  </table>

  <hr>

  <a href="Menu.html" class="btn btn-secondary">
    Volver al Men√∫ Principal
  </a>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function () {

  // üîê CONTROL DE SESI√ìN (AGREGADO)
  if (!localStorage.getItem("UsuarioActivo")) {
    window.location.href = "Login.html";
  }

  let movimientos = JSON.parse(localStorage.getItem("Movimientos")) || [];

  function textoMovimiento(tipo) {
    switch (tipo) {
      case "deposito":
        return "Dep√≥sito";
      case "retiro":
        return "Retiro de dinero";
      case "transferencia":
        return "Transferencia enviada";
      default:
        return "Movimiento";
    }
  }

  function mostrarMovimientos(filtro) {
    $("#tablaMovimientos").empty();

    const filtrados = movimientos.filter(function (mov) {
      return filtro === "todos" || mov.tipo === filtro;
    });

    if (filtrados.length === 0) {
      $("#tablaMovimientos").append(`
        <tr>
          <td colspan="3" class="text-center">
            No hay movimientos registrados
          </td>
        </tr>
      `);
      return;
    }

    filtrados.forEach(function (mov) {
      const color = mov.monto > 0 ? "text-success" : "text-danger";
      const signo = mov.monto > 0 ? "+" : "";

      $("#tablaMovimientos").append(`
        <tr>
          <td>${mov.fecha}</td>
          <td>${textoMovimiento(mov.tipo)}</td>
          <td class="${color}">
            ${signo}$${Math.abs(mov.monto)}
          </td>
        </tr>
      `);
    });
  }

  $("#filtroTipo").change(function () {
    mostrarMovimientos($(this).val());
  });

  // Mostrar todos al cargar
  mostrarMovimientos("todos");

});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
